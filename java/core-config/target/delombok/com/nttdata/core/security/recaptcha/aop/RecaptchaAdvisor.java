// Generated by delombok at Tue Jul 18 12:47:58 CEST 2023
/*******************************************************************************
 * Copyright (C) 2023 NTT DATA, All Rights Reserved
 *******************************************************************************/
package com.nttdata.core.security.recaptcha.aop;

import java.lang.reflect.Method;
import org.aopalliance.aop.Advice;
import org.aopalliance.intercept.MethodInterceptor;
import org.springframework.aop.Pointcut;
import org.springframework.aop.support.AbstractPointcutAdvisor;
import org.springframework.aop.support.StaticMethodMatcherPointcut;
import org.springframework.core.annotation.AnnotationUtils;
import com.nttdata.core.security.recaptcha.annotation.Recaptcha;

/**
 * Advisor to catch {@link Recaptcha} annotation over interfaces
 * 
 * @author NTT DATA
 * @since 0.0.1
 */
public class RecaptchaAdvisor extends AbstractPointcutAdvisor {
	/**
	 * serialVersionUID
	 */
	private static final long serialVersionUID = 1L;
	/**
	 * The method interceptor
	 */
	private final transient MethodInterceptor interceptor;
	/**
	 * Recaptcha pointcut
	 */
	private final transient StaticMethodMatcherPointcut pointcut = new RecaptchaAnnotationPointcut();

	/**
	 * Constructor.
	 * 
	 * @param interceptor {@link RecaptchaInterceptor}
	 */
	public RecaptchaAdvisor(RecaptchaInterceptor interceptor) {
		super();
		this.interceptor = interceptor;
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see org.springframework.aop.PointcutAdvisor#getPointcut()
	 */
	@Override
	public Pointcut getPointcut() {
		return this.pointcut;
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see org.springframework.aop.Advisor#getAdvice()
	 */
	@Override
	public Advice getAdvice() {
		return this.interceptor;
	}


	/**
	 * A matcher that matches:
	 * <ul>
	 * <li>A method on a class annotated with {@link Recaptcha}.</li>
	 * <li>A method on a class extending another class annotated with {@link Recaptcha}.</li>
	 * <li>A method on a class implementing an interface annotated with {@link Recaptcha}.</li>
	 * <li>A method implementing a method in a interface annotated with {@link Recaptcha}.</li>
	 * </ul>
	 * <p>
	 * <strong>Note:</strong> this uses springs utils to find the annotation and
	 * will not be portable outside the spring environment.
	 * </p>
	 */
	private final class RecaptchaAnnotationPointcut extends StaticMethodMatcherPointcut {
		/*
		 * (non-Javadoc)
		 * 
		 * @see org.springframework.aop.support.StaticMethodMatcher.matches(Method, Class<?>, Object...)
		 */
		@Override
		public boolean matches(Method method, Class<?> targetClass) {
			final Class<Recaptcha> annotationType = Recaptcha.class;
			return null != AnnotationUtils.findAnnotation(method, annotationType) || null != AnnotationUtils.findAnnotation(targetClass, annotationType);
		}
	}

	@java.lang.Override
	@java.lang.SuppressWarnings("all")
	public boolean equals(final java.lang.Object o) {
		if (o == this) return true;
		if (!(o instanceof RecaptchaAdvisor)) return false;
		final RecaptchaAdvisor other = (RecaptchaAdvisor) o;
		if (!other.canEqual((java.lang.Object) this)) return false;
		return true;
	}

	@java.lang.SuppressWarnings("all")
	protected boolean canEqual(final java.lang.Object other) {
		return other instanceof RecaptchaAdvisor;
	}

	@java.lang.Override
	@java.lang.SuppressWarnings("all")
	public int hashCode() {
		final int result = 1;
		return result;
	}
}
